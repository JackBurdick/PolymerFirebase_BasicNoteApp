<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="firebase-database-behavior.html">
<link rel="import" href="firebase.html">
<script>"use strict";Polymer({is:"firebase-document",behaviors:[Polymer.FirebaseDatabaseBehavior],attached:function(){this.__refChanged(this.ref,this.ref)},detached:function(){this.ref&&this.ref.off()},observers:["__refChanged(ref)"],get isNew(){return!this.path},get zeroValue(){return{}},save:function(t,e){return new Promise(function(i,a){var n;this.app||a(new Error("No app configured!")),e?(n=t+"/"+e,i(this._setFirebaseValue(n,this.data))):n=firebase.database(this.app).ref(t).push(this.data,function(t){return t?void a(t):void i()}).path.toString(),this.path=n}.bind(this))},reset:function(){return this.path=null,Promise.resolve()},destroy:function(){return this._setFirebaseValue(this.path,null).then(function(){return this.reset()}.bind(this))},memoryPathToStoragePath:function(t){var e=this.path;return"data"!==t&&(e+=t.replace(/^data\.?/,"/").split(".").join("/")),e},storagePathToMemoryPath:function(t){var e="data";return t=t.replace(this.path,"").split("/").join("."),t&&(e+="."+t),e},getStoredValue:function(t){return new Promise(function(e,i){this.ref.child(t).once("value",function(t){var i=t.val();null==i&&e(this.zeroValue),e(i)},this)}.bind(this))},setStoredValue:function(t,e){return this._setFirebaseValue(t,e)},__refChanged:function(t,e){e&&e.off("value",this.__onFirebaseValue,this),t&&t.on("value",this.__onFirebaseValue,this)},__onFirebaseValue:function(t){var e=t.val();null==e&&(e=this.zeroValue),this["new"]||this.async(function(){this.syncToMemory(function(){this._log("Updating data from Firebase value:",e),this.set("data",e)})})}});</script>
</head><body></body></html>
